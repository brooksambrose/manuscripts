---
title: "Appendix-Full"
author: "Brooks Ambrose"
date: "August 14, 2015"
output:
  html_document:
    highlight: textmate
    number_sections: yes
    toc: yes
---

# Introduction

This appendix explains the research procedures used to produce tables and figures in *Productions of Culture: Knowledge Survival in Art and Science*.

# Compiling Database from Source Records

## Thomson Reuters Web of Knowledge


Web of Knowledge (WOK) data that are available through regular subscriptions may be reported in a long, field-tagged, plain text format. The `wok2db.f` function recursively searches a directory for plain text batches of records and quickly imports them into R in a long format that may be easily queried. By default case standardization and deduplication by record ID is performed. The function returns a data.table object and optionally saves the same to the hard drive. Use of `data.table` provides accomodation for very large databases that perform poorly when treated as a data.frame.

```{r source,echo=F,message=FALSE}
library(data.table)
source(file = '../knowledge-survival/dissertation_source.R')
```

```{r wok2db-f,echo=T}
wok2db<-wok2db.f(
	dir='../knowledge-survival/in'
	,out='out'
	,sample.batches=T
	,sample.size=1
	,save=T
	,verbose=T
	,check.for.saved.output=T
)
wok2db
```

By default the data.table is keyed by its WOK id (the "UT" field), then by the field. This makes querying easy. To see the authors of the first three articles, we might enter:


```{r wok2db-usage1}
(first.three<-unique(wok2db$id)[1:3])
wok2db[list(id=first.three,field='AF')]
```

By default the value field is not keyed. While there are scenarios where this would be useful---e.g. for calling every record by a particular author, or every record in a particular year---keying also sorts the data.table, and the original sort order is important for fields like "TI" (title) which may be broken across several observations.

The `wok2db` object remains in the long format of the original data source. We can see this by simply calling the `wok2db` object itself or by using `expand.grid` to query multiple keys at once. Here was ask for the source journal, publication year, number of references, and total citations for each of the first three records.

```{r wok2db-usage2}
wok2db[expand.grid(first.three,c('SO','PY','AU','NR'))]
```

To sort results by record instead of field:

```{r wok2db-usage3}
wok2db[rev(expand.grid(c('SO','PY','AU','NR'),first.three))]
```

It is convenient to keep the original source data in a long format and to reshape it as necessary for use in different methods. This will be discussed in the *Formatting* section below.

## JSTOR Data for Research

Where WOK data are superior for the study of citations, the JSTOR Data for Research (JSTOR) service provides much of the bibliographic information available in WOK and sometimes more accurately. This makes it useful as a cross reference when assessing the quality of a WOK sample, or for augmenting fields such as authors' names.

In addition to these advantages, JSTOR data also provide ngram frequencies. These data are very valuable and allow partial full-text analysis using "bag of words" methods. The `jstor2db.f` function imports dfr.jstor.org records directly from the compressed files returned by queries to the service. Parallelization of the importing process is available and suitable for systems with fast disks. The function performs a standard set of pre-processing procedures on the ngram frequency tables contained in zip archives that include them. These tables and all other bibliographic data available are returned as a `data.table`.

```{r jstor2db-f,echo=TRUE,message=TRUE}
jstor2db<-jstor2db.f(
	dir='../knowledge-survival/supplemental/dfr.jstor.org-1k-samples'
	,out='out'
	,sample.batches=T
	,sample.size=1
	,in.parallel=F
	,drop.nchar1=T
	,check.for.saved.output=T
)
```


# Formatting

## Flat File

The `reshape2` package makes it easy to return the wide or flat file format of a query of a `wok2db` object.

```{r reshape}
library(reshape2)
dcast(
	data=wok2db[expand.grid(first.three,c('SO','PY','NR','TC'))]
	,formula=id~field
	,fun.aggregate=list
	,value.var='val'
)
```

Many of the interesting fields in WOK records are complex, having multiple observations per record. Some are falsely complex, such as title (TI), which stores a single observation across several fields. Simple and falsely complex values are often trivial features of the document itself. Truely complex field usually store named entities to which the article is related. The most important complex fiels are author (AU and AF) and cited reference (CR). Source journal is an example of a named entity field that is always simple, because a document is only published in one source at a time, though it may have several authors and citations.

```{r}
wok2db[expand.grid(first.three,c('AU','CR'))]
```


## Network

## Bag of Words

## Merging

## Survival

# Analytical Method

## Clique Percolation

## Topic Modelling

## Survival Analysis

# Reporting




